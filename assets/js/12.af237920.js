(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{590:function(t,s,e){"use strict";e.r(s);var a=e(17),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("blockquote",[e("p",[t._v("背景：磁盘压力告警，导致该slave节点上pod被驱逐，溯源知该节点的kubelet进程上报apiserver该节点的磁盘空间异常，而pod在节点上的生命周期均有kubelet 守护进程进行管理。")])]),t._v(" "),e("h2",{attrs:{id:"问题描述"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#问题描述"}},[t._v("#")]),t._v(" 问题描述")]),t._v(" "),e("p",[t._v("现象日志：")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@sh-k8s-slave-33 ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# systemctl status kubelet -l")]),t._v("\n● kubelet.service - kubelet: The Kubernetes Node Agent\n   Loaded: loaded "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("/usr/lib/systemd/system/kubelet.service"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" enabled"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" vendor preset: disabled"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  Drop-In: /usr/lib/systemd/system/kubelet.service.d\n           └─10-kubeadm.conf\n   Active: active "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("running"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" since Thu "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-03 "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(":31:27 CST"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" days ago\n     Docs: https://kubernetes.io/docs/\n Main PID: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30740")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("kubelet"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    Tasks: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v("\n   Memory: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(".2M\n   CGroup: /system.slice/kubelet.service\n           └─30740 /usr/bin/kubelet --bootstrap-kubeconfig"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/etc/kubernetes/kubelet.conf --config"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/var/lib/kubelet/config.yaml --network-plugin"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("cni --pod-infra-container-image"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("harbor.minstone.com:5002/k8s/pause:3.2 --eviction-hard"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("memory.available"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("%,nodefs.available"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("%,imagefs.available"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("%\n\nMar 09 08:41:58 sh-k8s-slave-33 kubelet"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30740")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": I0309 08:41:58.633306   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30740")]),t._v(" image_gc_manager.go:304"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("imageGCManager"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": Disk usage on image filesystem is at "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("88")]),t._v("% "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("which")]),t._v(" is over the high threshold "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("85")]),t._v("%"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(". Trying to "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("free")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("159344884940")]),t._v(" bytes down to the low threshold "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("%"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(".\nMar 09 08:41:58 sh-k8s-slave-33 kubelet"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30740")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": E0309 08:41:58.651972   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30740")]),t._v(" kubelet.go:1234"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Image garbage collection failed multiple "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("times")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" a row: failed to garbage collect required amount of images. Wanted to "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("free")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("159344884940")]),t._v(" bytes, but freed "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" bytes\nMar 09 08:46:58 sh-k8s-slave-33 kubelet"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30740")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": I0309 08:46:58.658250   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30740")]),t._v(" image_gc_manager.go:304"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("imageGCManager"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": Disk usage on image filesystem is at "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("88")]),t._v("% "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("which")]),t._v(" is over the high threshold "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("85")]),t._v("%"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(". Trying to "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("free")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("159358803148")]),t._v(" bytes down to the low threshold "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("%"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(".\nMar 09 08:46:58 sh-k8s-slave-33 kubelet"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30740")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": E0309 08:46:58.671174   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30740")]),t._v(" kubelet.go:1234"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Image garbage collection failed multiple "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("times")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" a row: failed to garbage collect required amount of images. Wanted to "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("free")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("159358803148")]),t._v(" bytes, but freed "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" bytes\nMar 09 08:51:58 sh-k8s-slave-33 kubelet"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30740")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": I0309 08:51:58.675513   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30740")]),t._v(" image_gc_manager.go:304"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("imageGCManager"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": Disk usage on image filesystem is at "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("88")]),t._v("% "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("which")]),t._v(" is over the high threshold "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("85")]),t._v("%"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(". Trying to "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("free")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("159360793804")]),t._v(" bytes down to the low threshold "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("%"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(".\nMar 09 08:51:58 sh-k8s-slave-33 kubelet"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30740")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": E0309 08:51:58.688335   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30740")]),t._v(" kubelet.go:1234"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Image garbage collection failed multiple "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("times")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" a row: failed to garbage collect required amount of images. Wanted to "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("free")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("159360793804")]),t._v(" bytes, but freed "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" bytes\nMar 09 08:56:58 sh-k8s-slave-33 kubelet"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30740")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": I0309 08:56:58.692723   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30740")]),t._v(" image_gc_manager.go:304"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("imageGCManager"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": Disk usage on image filesystem is at "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("88")]),t._v("% "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("which")]),t._v(" is over the high threshold "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("85")]),t._v("%"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(". Trying to "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("free")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("159360863436")]),t._v(" bytes down to the low threshold "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("%"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(".\nMar 09 08:56:58 sh-k8s-slave-33 kubelet"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30740")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": E0309 08:56:58.706110   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30740")]),t._v(" kubelet.go:1234"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Image garbage collection failed multiple "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("times")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" a row: failed to garbage collect required amount of images. Wanted to "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("free")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("159360863436")]),t._v(" bytes, but freed "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" bytes\nMar 09 09:01:58 sh-k8s-slave-33 kubelet"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30740")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": I0309 09:01:58.710107   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30740")]),t._v(" image_gc_manager.go:304"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("imageGCManager"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": Disk usage on image filesystem is at "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("88")]),t._v("% "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("which")]),t._v(" is over the high threshold "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("85")]),t._v("%"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(". Trying to "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("free")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("159376682188")]),t._v(" bytes down to the low threshold "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("%"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(".\nMar 09 09:01:58 sh-k8s-slave-33 kubelet"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30740")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": E0309 09:01:58.722325   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30740")]),t._v(" kubelet.go:1234"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Image garbage collection failed multiple "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("times")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" a row: failed to garbage collect required amount of images. Wanted to "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("free")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("159376682188")]),t._v(" bytes, but freed "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" bytes\n")])])]),e("p",[t._v("问题分析：\n同事在得知kubernetes默认的磁盘空间阈值在85%，遂通过kubelet启动参数调整了默认阈值，提升至93%，然而kubelet日志中提示的仍然是默认的85%\n猜测：\n修改的参数是发生pod驱逐的阈值，而kubelet日志中 "),e("em",[e("strong",[t._v("Image garbage collection failed multiple times in a row: failed to garbage collect required amount of images. Wanted to free 159360863436 bytes, but freed 0 b")])]),t._v(",其中的参数是指image gc的阈值，两者不同。")]),t._v(" "),e("h2",{attrs:{id:"源码追踪"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#源码追踪"}},[t._v("#")]),t._v(" 源码追踪")]),t._v(" "),e("ol",[e("li",[t._v("报错日志提示为：images_gc_manager.go文件的304行。\n"),e("em",[e("strong",[t._v("images_gc_manager.go ---\x3e func:GarbageCollect()")])])])]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("\t// If over the max threshold, "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("free")]),t._v(" enough to place us at the lower threshold.\n\tusagePercent :"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" - int"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("available*100/capacity"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" usagePercent "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v(" im.policy.HighThresholdPercent "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tamountToFree :"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" capacity*int64"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("-im.policy.LowThresholdPercent"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("/100 - available\n\t\tklog.Infof"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"[imageGCManager]: Disk usage on image filesystem is at %d%% which is over the high threshold (%d%%). Trying to free %d bytes down to the low threshold (%d%%)."')]),t._v(", usagePercent, im.policy.HighThresholdPercent, amountToFree, im.policy.LowThresholdPercent"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tfreed, err :"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" im.freeSpace"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("amountToFree, time.Now"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" nil "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" err\n\t\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" freed "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" amountToFree "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\terr :"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fmt.Errorf"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"failed to garbage collect required amount of images. Wanted to free %d bytes, but freed %d bytes"')]),t._v(", amountToFree, freed"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t\tim.recorder.Eventf"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("im.nodeRef, v1.EventTypeWarning, events.FreeDiskSpaceFailed, err.Error"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" err\n\t\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("提示在磁盘容量到达 HighThresholdPercent 时候，会执行 freeSpace 函数，用于通过镜像垃圾回收来清理磁盘空间，当回收镜像之后出来的磁盘空间之后仍高于LowThresholdPercent 时，抛出 failed to garbage collect required amount of images 异常。\n其中：policy.HighThresholdPercent 和 policy.LowThresholdPercent 均为 kubelet 的镜像垃圾回收的策略，当磁盘容量大于 policy.HighThresholdPercent 时，镜像垃圾回收会一直保持运行，并遵循一定的时间间隔；当磁盘容量低于 policy.LowThresholdPercent 时，镜像垃圾回收不会触发。这些参数可以通过kubelet的启动参数进行设定，启动参数分别为 --image-gc-high-threshold 和 --image-gc-low-threshold，取值区间为[1,100]，low的值不能大于high的值；当不想执行镜像垃圾回收时，将high值设置为100即可。")]),t._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[t._v("问题：命令行参数 --eviction-hard的作用是什么?\n通过第一步查看 GarbageCollect() 函数的调用者")])])])}),[],!1,null,null,null);s.default=n.exports}}]);